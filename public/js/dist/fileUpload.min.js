var fileUpload=function(){function a(a){console.log("%c Getting signed request.","background-color: blue; color: white;"),console.log("file:",a);var c="/image/sign_s3?file_name="+a.name+"&file_type="+a.type;$.ajax({url:c,method:"GET",dataType:"json",success:function(c){console.log("data from signed request:",c),b(a,c.SignedRequest,c.url)}})}function b(a,b,d){console.log("%c Uploading file","background-color: yellow;"),console.log("file:",a),console.log("signedRequest:",b),console.log("url:",d),$.ajax({url:b,method:"PUT",data:a,contentType:a.type,processData:!1,beforeSend:function(a){a.setRequestHeader("x-amz-acl","public-read")},success:function(){console.log("%c Photo successfully uploaded.","background-color: red; color: white;"),c({url:d})}})}function c(a){console.log("Updating database."),console.log(a),$.ajax({url:"/image/upload",method:"POST",data:a,success:function(){console.log("%c Database successfully updated.","background-color: green; color: white;"),d()}})}function d(){var a=$("form")[0];a.reset(),$("#upload-text").text("Photo uploaded!"),setTimeout(function(){$("#upload-text").text("Â ")},3e3)}return{getSignedRequest:a,uploadFile:b,updateDatabase:c}}();$(function(){$("#upload").on("change",function(){console.log("%c File selected.","background-color: green; color: white;");var a=$("#upload").prop("files"),b=a[0];null==b?alert("Please select a file."):(fileUpload.getSignedRequest(b,fileUpload.uploadFile),$("#upload-text").text("Uploading photo..."))})});
